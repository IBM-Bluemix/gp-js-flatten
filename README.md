Un/Flattener for jsonpath
=========================

Experimental adjunct to the
[Globalization Pipeline Node.js SDK](https://github.com/IBM-Bluemix/gp-js-client).

[![npm version](https://badge.fury.io/js/g11n-pipeline-flatten.svg)](https://badge.fury.io/js/g11n-pipeline-flatten)
[![Build Status](https://travis-ci.org/srl295/gp-js-flatten.svg?branch=master)](https://travis-ci.org/srl295/gp-js-flatten)
[![Coverage Status](https://coveralls.io/repos/github/srl295/gp-js-flatten/badge.svg)](https://coveralls.io/github/srl295/gp-js-flatten)

Purpose
-------

The purpose of this utility is to flatten key/value pairs so that all keys and values are strings. Some types are ignored, such as empty right hand side values.

Also simple keys and values are by default left alone, so `{key: "value"}=flatten({key:"value"})`.
The `flattenAll: true` option will include these keys in the flattening.

Usage
-----

Given `input=`:

<code>
{
    &quot;foo&quot;: &quot;foo&quot;,
    &quot;bar&quot;: &quot;bar&quot;,
    &quot;baz&quot;: {
        &quot;quux&quot;: true,
        &quot;hey&quot;: &quot;hi&quot;,
        &quot;π&quot;: 3.14159,
        &quot;ignored1&quot;: [],
        &quot;ignored2&quot;: {}
    },
    &quot;list&quot;: [ &quot;a&quot;, &quot;b&quot;, &quot;c&quot; ]
}
</code>

and

```js
const flatten = require('g11n-pipeline-flatten');
const flat = flatten.flatten(input);
```

gives

<code>
{
    &quot;foo&quot;: &quot;foo&quot;,
    &quot;bar&quot;: &quot;bar&quot;,
    &quot;$.baz.quux&quot;: &quot;true&quot;,
    &quot;$.baz.hey&quot;: &quot;hi&quot;,
    &quot;$.baz[\&quot;π\&quot;]&quot;: &quot;3.14159&quot;,
    &quot;$.list[0]&quot;: &quot;a&quot;,
    &quot;$.list[1]&quot;: &quot;b&quot;,
    &quot;$.list[2]&quot;: &quot;c&quot;
}
</code>

and then

```js
const expand = flatten.expand(flat);
```

gives


<code>
{
    &quot;foo&quot;: &quot;foo&quot;,
    &quot;bar&quot;: &quot;bar&quot;,
    &quot;baz&quot;: {
        &quot;quux&quot;: &quot;true&quot;,
        &quot;hey&quot;: &quot;hi&quot;,
        &quot;π&quot;: &quot;3.14159&quot;
    },
    &quot;list&quot;: {
        &quot;0&quot;: &quot;a&quot;,
        &quot;1&quot;: &quot;b&quot;,
        &quot;2&quot;: &quot;c&quot;
    }
}
</code>

Using with the Globalization Pipeline
-------------------------------------

The flattener allows you to use deeply nested JSON structures with the [Globalization Pipeline Node.js SDK](https://github.com/IBM-Bluemix/gp-js-client), which service otherwise only supports flat key/value pairs.

See [./sample/SAMPLE-README.md](./sample/SAMPLE-README.md) for a full tutorial. The below gives a simple quickstart.

For example, you can “flatten” a JSON object before uploading to the Globalization Pipeline.

```js
const flattener = require('g11n-pipeline-flatten')
var gpClient = require('g11n-pipeline').getClient(…);
gpClient.bundle('mybundle').uploadStrings({
    languageId: 'en',
    strings: flattener.flatten(require('./en.json'));
}, …);
```

Conversely, you can then “expand” the results when downloading from it.

```js
const flattener = require('g11n-pipeline-flatten')
var gpClient = require('g11n-pipeline').getClient(…);
gpClient.bundle('mybundle').getStrings({
    languageId: 'en',
}, (err, result) => {
    …
    const expanded = flattener.expand(result.resourceStrings);
    // “expanded” is now the nested structure
});
```





API reference
-------------

## Functions

<dl>
<dt><a href="#flatten">flatten(obj, [opts])</a></dt>
<dd><p>Flatten a deeply nested object into its jsonpath equivalent</p>
</dd>
<dt><a href="#expand">expand(flattened, [opts])</a></dt>
<dd><p>Expand a flattened object into its deep equivalent</p>
</dd>
</dl>

<a name="flatten"></a>

## flatten(obj, [opts])
Flatten a deeply nested object into its jsonpath equivalent

**Kind**: global function  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| obj | <code>Object</code> |  | The input object |
| [opts] | <code>Object</code> |  | Optional input parameters |
| [opts.flattenAll] | <code>Boolean</code> | <code>false</code> | If true, flatten all values, even simple top level keys. |

<a name="expand"></a>

## expand(flattened, [opts])
Expand a flattened object into its deep equivalent

**Kind**: global function  

| Param | Type | Description |
| --- | --- | --- |
| flattened | <code>Object.&lt;string, string&gt;</code> | The flattened object |
| [opts] | <code>Object</code> | Optional input parameters |


*docs autogenerated via [jsdoc2md](https://github.com/jsdoc2md/jsdoc-to-markdown)*

Contributing
------------

See [CONTRIBUTING.md](CONTRIBUTING.md).

License
-------

Apache 2.0. See [LICENSE.txt](LICENSE.txt)

> Licensed under the Apache License, Version 2.0 (the "License");
> you may not use this file except in compliance with the License.
> You may obtain a copy of the License at
> 
> http://www.apache.org/licenses/LICENSE-2.0
> 
> Unless required by applicable law or agreed to in writing, software
> distributed under the License is distributed on an "AS IS" BASIS,
> WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
> See the License for the specific language governing permissions and
> limitations under the License.
